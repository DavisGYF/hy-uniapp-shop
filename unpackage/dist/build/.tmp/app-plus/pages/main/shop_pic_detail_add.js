(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/main/shop_pic_detail_add"],{"7fbd":function(t,e,a){"use strict";a("7297");var i=s(a("b0ce")),n=s(a("a388"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(n.default))},a1a6:function(t,e,a){"use strict";a.r(e);var i=a("f3f1"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},a388:function(t,e,a){"use strict";a.r(e);var i=a("cae8"),n=a("a1a6");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("de81");var o=a("2877"),u=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,"71b477af",null);e["default"]=u.exports},b791:function(t,e,a){},cae8:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"content"},[a("form",{attrs:{eventid:"8644d7e0-3"},on:{submit:t.formSubmit,reset:t.formReset}},[a("view",{staticClass:"uni-list list-pd"},[a("view",{staticClass:"uni-list-cell"},[a("label",[t._v("照片描述")]),a("view",{staticClass:"uni-list-cell-right"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"uni-input",attrs:{name:"description",placeholder:"请输入",eventid:"8644d7e0-0"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])],1),a("view",{staticClass:"uni-list-cell cell-pd"},[a("view",{staticClass:"uni-uploader"},[a("view",{staticClass:"uni-uploader-head"},[a("view",{staticClass:"uni-uploader-title"},[t._v("上传照片")])]),a("view",{staticClass:"uni-uploader-body"},[a("view",{staticClass:"uni-uploader__files"},[t.image1?a("view",{staticClass:"uni-uploader__file"},[a("image",{staticClass:"uni-uploader__img",attrs:{mode:"aspectFill",src:t.image1,"data-src":t.image1,eventid:"8644d7e0-1"},on:{tap:function(e){t.previewImage()}}})]):t._e(),a("view",{staticClass:"uni-uploader__input-box"},[a("view",{staticClass:"uni-uploader__input",attrs:{eventid:"8644d7e0-2"},on:{tap:function(e){t.chooseImageFn()}}})])])])])])]),a("view",{staticClass:"uni-btn-v"},[a("button",{staticClass:"btn-submit",attrs:{formType:"submit",type:"primary"}},[t._v("提交")])],1)])],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},de81:function(t,e,a){"use strict";var i=a("b791"),n=a.n(i);n.a},f3f1:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("a34a"));function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,i,n,s,o){try{var u=t[s](o),c=u.value}catch(r){return void a(r)}u.done?e(c):Promise.resolve(c).then(i,n)}function o(t){return function(){var e=this,a=arguments;return new Promise(function(i,n){var o=t.apply(e,a);function u(t){s(o,i,n,u,c,"next",t)}function c(t){s(o,i,n,u,c,"throw",t)}u(void 0)})}}var u=a("7389"),c={data:function(){return{image1:"",imageList:[],uploaddata:{},album_id:"",description:""}},onShow:function(){},onLoad:function(t){console.log("上来--------------",JSON.parse(t.data)),this.album_id=JSON.parse(t.data),this.getOssParam()},methods:{chooseImageFn:function(){var e=o(i.default.mark(function e(){var a;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,t.chooseImage({count:1,success:function(e){var i=e.tempFilePaths;console.log("res?-=======",JSON.stringify(e));var n=a.uploaddata.dir+Date.parse(new Date)+"_"+a.randomString(6)+"."+i[0].split(".").pop();t.uploadFile({url:"https://ffomall.oss-cn-hangzhou.aliyuncs.com",filePath:i[0],name:"file",formData:{key:n,policy:a.uploaddata.policy,OSSAccessKeyId:a.uploaddata.OSSAccessKeyId,callback:a.uploaddata.callback,signature:a.uploaddata.signature,success_action_status:"203"},success:function(t){console.log("uploadImage success, res is:",t.data),a.image1="https://ffomall.oss-cn-hangzhou.aliyuncs.com/"+JSON.parse(t.data).filename},fail:function(e){console.log("uploadImage fail",JSON.stringify(e)),t.showModal({content:e.errMsg,showCancel:!1}),t.hideLoading()},complete:function(){console.log("complate")}})}});case 2:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),randomString:function(t,e){e=e||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var a="",i=0;i<t;i++){var n=Math.floor(Math.random()*e.length);a+=e.substring(n,n+1)}return a},getOssParam:function(){var e=this;t.request({url:this.base_url+"notify/alioss/getsign",method:"post",data:{sign:"3521257fc593c5d202474f6ac0c245ae"},success:function(t){console.log("res?-",t),1==t.data.status&&(e.uploaddata=t.data.data)},fail:function(){},complete:function(){}})},formReset:function(t){console.log("清空数据"),this.chosen=""},previewImage:function(e,a){t.previewImage({urls:[this.image1]})},formSubmit:function(e){var a=this;console.log("shangchuanzuishuju--------------",a.image1);var i=[{name:"description",checkType:"notnull",checkRule:"",errorMsg:"照片描述必填"}],n=e.detail.value,s=u.check(n,i);if(s){if(""==this.image1)return t.showToast({title:"照片必填!",icon:"none"}),!1;this.$util.ajax_uni({url:"merchants/Adimg/insertPicture",data:{img_id:a.album_id,img_url:a.image1,describe:a.description},success:function(e){console.log("返回数据状态res:",e),1==e.data.status?t.navigateBack({url:"./shop_pic_detail"}):(console.log("ceeee",JSON.stringify(e.data)),t.showToast({icon:"loading",title:e.data.msg}))},error:function(t){console.log("错误res:",t)}})}else t.showToast({title:u.error,icon:"none"})}}};e.default=c}).call(this,a("649d")["default"])}},[["7fbd","common/runtime","common/vendor"]]]);