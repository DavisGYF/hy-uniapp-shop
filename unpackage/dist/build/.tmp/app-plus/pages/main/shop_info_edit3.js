(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/main/shop_info_edit3"],{"41b7":function(t,e,a){"use strict";a.r(e);var i=a("d7b0"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},4239:function(t,e,a){"use strict";a("7297");var i=s(a("b0ce")),o=s(a("4aa5"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(o.default))},"4aa5":function(t,e,a){"use strict";a.r(e);var i=a("b46b"),o=a("41b7");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("8721");var n=a("2877"),l=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,"27a37876",null);e["default"]=l.exports},8721:function(t,e,a){"use strict";var i=a("a26c"),o=a.n(i);o.a},a26c:function(t,e,a){},b46b:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"content"},[a("view",[a("van-steps",{attrs:{steps:t.steps,active:t.active,mpcomid:"6d461f20-0"}})],1),a("view",[a("form",{attrs:{eventid:"6d461f20-8"},on:{submit:t.formSubmit,reset:t.formReset}},[a("view",{staticClass:"uni-list"},[a("view",{staticClass:"uni-list-cell "},[a("view",{staticClass:"uni-title"},[t._v("证件上传")])]),a("view",{staticClass:"uni-list-cell cell-pd"},[a("view",{staticClass:"uni-uploader"},[a("view",{staticClass:"uni-uploader-head"},[a("view",{staticClass:"uni-uploader-title"},[t._v("招牌照片")])]),a("view",{staticClass:"uni-uploader-body"},[a("view",{staticClass:"uni-uploader__files"},[a("block",[a("view",{staticClass:"uni-uploader__file",staticStyle:{width:"60%"}},[a("image",{staticClass:"uni-uploader__img",attrs:{mode:"aspectFit",src:t.text_info.store_img,"data-src":t.text_info.store_img,eventid:"6d461f20-0"},on:{tap:function(e){t.previewImagFn(t.text_info.store_img)}}})])]),a("view",{staticClass:"uni-uploader__input-box"},[a("view",{staticClass:"uni-uploader__input",attrs:{eventid:"6d461f20-1"},on:{tap:function(e){t.chooseImageFn(2)}}})])],1)])])]),a("view",{staticClass:"uni-list-cell cell-pd"},[a("view",{staticClass:"uni-uploader"},[a("view",{staticClass:"uni-uploader-head"},[a("view",{staticClass:"uni-uploader-title"},[t._v("营业执照")])]),a("view",{staticClass:"uni-uploader-body"},[a("view",{staticClass:"uni-uploader__files"},[""!=t.text_info.store_img1?a("view",{staticClass:"uni-uploader__file"},[a("image",{staticClass:"uni-uploader__img",attrs:{mode:"aspectFill",src:t.text_info.store_img1,"data-src":t.text_info.store_img1,eventid:"6d461f20-2"},on:{tap:function(e){t.previewImagFn(t.text_info.store_img1)}}})]):t._e(),1!=t.text_info.status?a("view",{staticClass:"uni-uploader__input-box"},[a("view",{staticClass:"uni-uploader__input",attrs:{eventid:"6d461f20-3"},on:{tap:function(e){t.chooseImageFn(3)}}})]):t._e()])])])]),a("view",{staticClass:"uni-list-cell cell-pd"},[a("view",{staticClass:"uni-uploader"},[a("view",{staticClass:"uni-uploader-head"},[a("view",{staticClass:"uni-uploader-title"},[t._v("身份证正反面")])]),a("view",{staticClass:"uni-uploader-body"},[a("view",{staticClass:"uni-uploader__files"},[t._l(t.id_image_ist,function(e,i){return a("block",{key:i},[a("view",{staticClass:"uni-uploader__file"},[1==t.text_info.status?a("image",{staticClass:"uni-uploader__img",attrs:{mode:"aspectFill",src:e,"data-src":e,eventid:"6d461f20-4-"+i},on:{tap:function(a){t.previewImagFns(e,i,1)}}}):t._e(),1!=t.text_info.status?a("image",{staticClass:"uni-uploader__img",attrs:{mode:"aspectFill",src:e,"data-src":e,eventid:"6d461f20-5-"+i},on:{tap:function(a){t.previewImagFns(e,i)}}}):t._e()])])}),1!=t.text_info.status?a("view",{staticClass:"uni-uploader__input-box"},[a("view",{staticClass:"uni-uploader__input",attrs:{eventid:"6d461f20-6"},on:{tap:function(e){t.chooseImageFns(t.image)}}})]):t._e()],2)])])]),a("view",{staticClass:"uni-list-cell"},[t._v("身份证号"),a("view",{staticClass:"uni-list-cell-right"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.text_info.id_card,expression:"text_info.id_card"}],staticClass:"uni-input",attrs:{disabled:1==t.text_info.status,type:"idcard",name:"id_card",placeholder:"请输入",eventid:"6d461f20-7"},domProps:{value:t.text_info.id_card},on:{input:function(e){e.target.composing||(t.text_info.id_card=e.target.value)}}})])])])])],1),a("view",{staticClass:"uni-btn-v"},[a("button",{staticClass:"btn-submit",attrs:{type:"primary",eventid:"6d461f20-9"},on:{tap:t.formSubmit}},[t._v("确认")])],1)])},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})},d7b0:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(a("a34a")),o=s(a("7861"));function s(t){return t&&t.__esModule?t:{default:t}}function n(t,e,a,i,o,s,n){try{var l=t[s](n),c=l.value}catch(r){return void a(r)}l.done?e(c):Promise.resolve(c).then(i,o)}function l(t){return function(){var e=this,a=arguments;return new Promise(function(i,o){var s=t.apply(e,a);function l(t){n(s,i,o,l,c,"next",t)}function c(t){n(s,i,o,l,c,"throw",t)}l(void 0)})}}a("7389");var c={components:{uniSegmentedControl:o.default},data:function(){return{steps:[{text:"基本信息",desc:""},{text:"店铺介绍",desc:""},{text:"证件上传",desc:""}],active:2,storeListAll:[],storeList:[],cat_index:0,array:["餐饮美食","洗浴住宿","观影k哥"],array1:["正常营业","休息中","已关店"],array_index:0,activeColor:"#0faeff",styleType:"button",uploaddata:{},uploaddata_id:{},text_info:{},latitude:null,longitude:null,covers_markers:[],mapCtx:null,id_image_ist:[]}},onShow:function(){var t=this;console.log("---------store show===text_info",this.$store.state.shop_edit_info.length,JSON.stringify(this.$store.state.shop_edit_info)),t.text_info&&(console.log("store youhuo"),t.text_info=this.$store.state.shop_edit_info,void 0==t.text_info.profile_picture1&&void 0!=t.text_info.profile_picture2?(console.log("stroe---\x3e",0),t.id_image_ist=[t.text_info.profile_picture2]):void 0==t.text_info.profile_picture2&&void 0!=t.text_info.profile_picture1?(console.log("stroe---\x3e",1),t.id_image_ist=[t.text_info.profile_picture1]):void 0==t.text_info.profile_picture1&&void 0==t.text_info.profile_picture2?(console.log("stroe---\x3e","00"),t.id_image_ist=[]):(console.log("stroe---\x3e",2),t.id_image_ist=[t.text_info.profile_picture1,t.text_info.profile_picture2]))},onLoad:function(t){this.getData(),this.getOssParam(),this.getOssParamId(),this.imageList=[]},methods:{getData:function(){var e=this;this.$util.ajax_uni({url:"merchants/index/show",data:{ff_openid:t.getStorageSync("user_id")},success:function(a){console.log("返回店铺信息res:",a),1==a.data.status?(e.text_info=a.data.data.data,e.getStore(),console.log("---------store onload===text_info",JSON.stringify(e.text_info)),void 0==e.text_info.profile_picture1?(console.log(0),e.id_image_ist=[e.text_info.profile_picture2]):void 0==e.text_info.profile_picture2?(console.log(1),e.id_image_ist=[e.text_info.profile_picture1]):(console.log(2),e.id_image_ist=[e.text_info.profile_picture1,e.text_info.profile_picture2]),console.log("id_image_ist===========",JSON.stringify(e.id_image_ist))):(console.log("ceeee",JSON.stringify(a.data)),t.showToast({icon:"none",title:a.data.msg}))},error:function(t){console.log("错误res:",t)}})},getStore:function(){var e=this;this.$util.ajax_uni({url:"merchants/index/cat",data:{},success:function(a){if(1==a.data.status)for(var i in e.storeListAll=a.data.data,a.data.data)a.data.data[i].value=a.data.data[i].id,e.storeList.push(a.data.data[i].name),a.data.data[i].id==e.text_info.cat_id&&(e.cat_index=i);else console.log("ceeee",JSON.stringify(a.data)),t.showToast({icon:"none",title:a.data.msg})},error:function(t){console.log("错误res:",t)}})},nextStepsFn:function(){console.log("active--",this.active,"current===",this.current),this.active<2&&(this.active+=1,this.current+=1)},preStepsFn:function(){console.log("active--",this.active,"current===",this.current),this.active>0&&(this.active-=1,this.current-=1)},bindPickerChange1:function(t){console.log("picker发送选择改变，携带值为",t.target.value),this.text_info.store_status=t.target.value},catChange:function(t){console.log("picker发送选择改变，携带值为",t.target.value),this.cat_index=t.target.value,this.text_info.cat_id=this.storeListAll[t.target.value].id},onClickItem:function(t){this.current!==t&&(this.current=t)},previewImagFn:function(e,a){t.previewImage({urls:[e]})},previewImagFns:function(e,a,i){console.log("chooseImageFns----",e),1==i?t.previewImage({current:this.id_image_ist[a],urls:this.id_image_ist}):(this.$store.commit("changeShopEditInfo",this.text_info),t.navigateTo({url:"./shop_img_detail?data="+e+"&&flag="+a}))},chooseImageFn:function(){var e=l(i.default.mark(function e(a){var o;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=this,e.t0=a,e.next=1===e.t0?4:2===e.t0?6:3===e.t0?8:4===e.t0?10:11;break;case 4:return t.chooseImage({count:1,success:function(e){var a=e.tempFilePaths;console.log("res?-=======",JSON.stringify(e));var i=o.uploaddata.dir+Date.parse(new Date)+"_"+o.randomString(6)+"."+a[0].split(".").pop();t.uploadFile({url:"https://ffomall.oss-cn-hangzhou.aliyuncs.com",filePath:a[0],name:"file",formData:{key:i,policy:o.uploaddata.policy,OSSAccessKeyId:o.uploaddata.OSSAccessKeyId,callback:o.uploaddata.callback,signature:o.uploaddata.signature,success_action_status:"203"},success:function(t){console.log("uploadImage success, res is:",t.data),o.text_info.avatar="https://ffomall.oss-cn-hangzhou.aliyuncs.com/"+JSON.parse(t.data).filename},fail:function(e){console.log("uploadImage fail",JSON.stringify(e)),t.showModal({content:e.errMsg,showCancel:!1}),t.hideLoading()},complete:function(){console.log("complate")}})}}),e.abrupt("break",12);case 6:return t.chooseImage({count:1,success:function(e){var a=e.tempFilePaths;console.log("res?-=======",JSON.stringify(e));var i=o.uploaddata.dir+Date.parse(new Date)+"_"+o.randomString(6)+"."+a[0].split(".").pop();t.uploadFile({url:"https://ffomall.oss-cn-hangzhou.aliyuncs.com",filePath:a[0],name:"file",formData:{key:i,policy:o.uploaddata.policy,OSSAccessKeyId:o.uploaddata.OSSAccessKeyId,callback:o.uploaddata.callback,signature:o.uploaddata.signature,success_action_status:"203"},success:function(t){console.log("uploadImage success, res is:",t.data),o.text_info.store_img="https://ffomall.oss-cn-hangzhou.aliyuncs.com/"+JSON.parse(t.data).filename},fail:function(e){console.log("uploadImage fail",JSON.stringify(e)),t.showModal({content:e.errMsg,showCancel:!1}),t.hideLoading()},complete:function(){console.log("complate")}})}}),e.abrupt("break",12);case 8:return t.chooseImage({count:1,success:function(e){var a=e.tempFilePaths;console.log("res?-=======",JSON.stringify(e));var i=o.uploaddata.dir+Date.parse(new Date)+"_"+o.randomString(6)+"."+a[0].split(".").pop();t.uploadFile({url:"https://ffomall.oss-cn-hangzhou.aliyuncs.com",filePath:a[0],name:"file",formData:{key:i,policy:o.uploaddata.policy,OSSAccessKeyId:o.uploaddata.OSSAccessKeyId,callback:o.uploaddata.callback,signature:o.uploaddata.signature,success_action_status:"203"},success:function(t){console.log("uploadImage success------, res is:",t.data),o.text_info.store_img1="https://ffomall.oss-cn-hangzhou.aliyuncs.com/"+JSON.parse(t.data).filename,console.log("--修改",JSON.stringify(o.text_info))},fail:function(e){console.log("uploadImage fail",JSON.stringify(e)),t.showModal({content:e.errMsg,showCancel:!1})},complete:function(){console.log("complate")}})}}),e.abrupt("break",12);case 10:return e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:case"end":return e.stop()}},e,this)}));function a(t){return e.apply(this,arguments)}return a}(),chooseImageFns:function(e){var a=this;console.log("chooseImage--Fns----",e),2!=a.id_image_ist.length?t.chooseImage({count:2,success:function(e){var i=e.tempFilePaths;for(var o in console.log("res?-=======",JSON.stringify(e)),i){var s=a.uploaddata_id.dir+Date.parse(new Date)+"_"+a.randomString(6)+"."+i[o].split(".").pop();t.uploadFile({url:"https://ffomallcardid.oss-cn-hangzhou.aliyuncs.com",filePath:i[o],name:"file",formData:{key:s,policy:a.uploaddata_id.policy,OSSAccessKeyId:a.uploaddata_id.OSSAccessKeyId,callback:a.uploaddata_id.callback,signature:a.uploaddata_id.signature,success_action_status:"203"},success:function(t){a.id_image_ist.push("https://ffomallcardid.oss-cn-hangzhou.aliyuncs.com/"+JSON.parse(t.data).filename),console.log("uploadImage =====jiddddddd=:",JSON.stringify(a.id_image_ist))},fail:function(e){console.log("uploadImage fail",JSON.stringify(e)),t.showModal({content:e.errMsg,showCancel:!1}),t.hideLoading()},complete:function(){console.log("complate")}})}}}):t.showToast({title:"请先删除照片",icon:"none"})},randomString:function(t,e){e=e||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var a="",i=0;i<t;i++){var o=Math.floor(Math.random()*e.length);a+=e.substring(o,o+1)}return a},getOssParam:function(){var e=this;t.request({url:this.base_url+"notify/alioss/getsign",method:"post",data:{sign:"3521257fc593c5d202474f6ac0c245ae"},success:function(t){console.log("res?-",t),1==t.data.status&&(e.uploaddata=t.data.data)},fail:function(){},complete:function(){}})},getOssParamId:function(){var e=this;t.request({url:this.base_url+"merchants/index/upload",method:"post",data:{token:t.getStorageSync("token")},success:function(t){console.log("res?========-",t),1==t.data.status&&(e.uploaddata_id=t.data.data)},fail:function(){},complete:function(){}})},formReset:function(t){console.log("清空数据"),this.chosen=""},previewImageFn:function(e){t.previewImage({urls:[e]})},choseLocation:function(){var e=this;console.log("位置名称：--------"),t.chooseLocation({success:function(t){console.log("位置名称："+t.name),console.log("详细地址："+t.address),console.log("纬度："+t.latitude),console.log("经度："+t.longitude),e.longitude=t.longitude,e.latitude=t.latitude,e.covers_markers.pop(),e.covers_markers.push({latitude:t.latitude,longitude:t.longitude,label:{content:t.name}})}})},getLocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){console.log("当前位置的纬度："+t.latitude),e.longitude=t.longitude,e.latitude=t.latitude,e.covers_markers.push({latitude:t.latitude,longitude:t.longitude})},fail:function(t){console.log("res-fail",t)}})},formSubmit:function(e){var a="";a=1==this.text_info.status?"merchants/index/updateRegistered":"merchants/index/updateReg",this.text_info.profile_picture1=this.id_image_ist[0],this.text_info.profile_picture2=this.id_image_ist[1],console.log("入参---修改",JSON.stringify(this.text_info)),this.$util.ajax_uni({url:a,data:this.text_info,success:function(e){console.log("修改--返回---es:",e),1==e.data.status?t.navigateBack({url:"./shop_info"}):(console.log("ceeee",JSON.stringify(e.data)),t.showToast({icon:"none",title:e.data.msg}))},error:function(t){console.log("错误res:",t)}})}}};e.default=c}).call(this,a("649d")["default"])}},[["4239","common/runtime","common/vendor"]]]);